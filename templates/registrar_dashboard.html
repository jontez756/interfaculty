{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Registrar Dashboard</h4>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs mb-4">
                    <li class="nav-item">
                        <a class="nav-link active" href="#pending" data-bs-toggle="tab">Pending Review</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#completed" data-bs-toggle="tab">Completed Transfers</a>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- Pending Applications Tab -->
                    <div class="tab-pane fade show active" id="pending">
                        <h5>Dean-Approved Applications</h5>
                        {% if pending_applications %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Student</th>
                                            <th>Current Admission</th>
                                            <th>From Program</th>
                                            <th>To Program</th>
                                            <th>Dean</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for app in pending_applications %}
                                            <tr>
                                                <td>{{ app.application_date|date:"M d, Y" }}</td>
                                                <td>{{ app.student.user.get_full_name }}</td>
                                                <td>{{ app.student.admission_number }}</td>
                                                <td>{{ app.current_program.faculty.code }}</td>
                                                <td>{{ app.requested_program.faculty.code }}</td>
                                                <td>{{ app.requested_program.faculty.dean_name|default:"â€”" }}</td>
                                                <td>
                                                    <a href="{% url 'registrar_review' app.id %}" class="btn btn-sm btn-primary">
                                                        Review & Issue Number
                                                    </a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                No applications pending your review.
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Completed Transfers Tab -->
                    <div class="tab-pane fade" id="completed">
                        <h5>Completed Transfers</h5>
                        {% if completed_transfers %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Student</th>
                                            <th>Old Admission</th>
                                            <th>New Admission</th>
                                            <th>New Program</th>
                                            <th>Approved By</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for app in completed_transfers %}
                                            <tr>
                                                <td>{{ app.last_updated|date:"M d, Y" }}</td>
                                                <td>{{ app.student.user.get_full_name }}</td>
                                                <td>{{ app.student.admission_number }}</td>
                                                <td><span class="badge bg-success">{{ app.new_admission_number }}</span></td>
                                                <td>{{ app.requested_program.faculty.code }}</td>
                                                <td>Registrar</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                No completed transfers yet.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

